<div class="bg-white rounded-lg border border-gray-200 p-6 mb-6">
  <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
    <i class="fas fa-star text-yellow-500 mr-2"></i>
    Notation personnelle
  </h3>

  <% if existing_rating && existing_rating > 0 %>
    <div class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg">
      <div class="flex items-center justify-between">
        <div>
          <div class="flex items-center mb-2">
            <% 5.times do |i| %>
              <i class="fas fa-star <%= i < existing_rating ? 'text-yellow-500' : 'text-gray-300' %> mr-1"></i>
            <% end %>
            <span class="ml-2 text-sm font-medium text-gray-700"><%= existing_rating %>/5</span>
          </div>
          <% if existing_comment.present? %>
            <p class="text-sm text-gray-600 italic">"<%= existing_comment %>"</p>
          <% end %>
        </div>
        <% if recipe.user == current_user && recipe.recipe_rating %>
          <div class="flex gap-2">
            <%= button_to recipe_recipe_rating_path(recipe, recipe.recipe_rating),
                          method: :delete,
                          class: "text-red-600 hover:text-red-800 text-sm font-medium",
                          data: { confirm: "Supprimer cette notation ?" } do %>
              <i class="fas fa-trash mr-1"></i>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if recipe.user == current_user %>
    <div data-controller="recipe-rating" data-recipe-rating-current-rating-value="<%= existing_rating || 0 %>">
      <%= form_with model: [recipe, RecipeRating.new],
                    url: recipe_recipe_ratings_path(recipe),
                    method: :post,
                    class: "space-y-4" do |f| %>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Note sur 5 étoiles</label>
          <div class="flex items-center space-x-2" data-recipe-rating-target="starContainer" data-action="mouseleave->recipe-rating#leaveStars">
            <% 5.times do |i| %>
              <button type="button"
                      class="star-btn text-2xl transition-colors duration-200 hover:scale-110"
                      data-rating="<%= i + 1 %>"
                      data-recipe-rating-target="star"
                      data-action="click->recipe-rating#selectRating mouseenter->recipe-rating#hoverRating">
                <i class="fas fa-star text-gray-300 hover:text-yellow-400"></i>
              </button>
            <% end %>
          </div>
          <%= f.hidden_field :rating, value: existing_rating || 0, data: { recipe_rating_target: "ratingInput" } %>
        </div>

        <div>
          <label for="recipe_rating_comment" class="block text-sm font-medium text-gray-700 mb-2">
            Commentaire (optionnel)
          </label>
          <%= f.text_area :comment,
                          value: existing_comment,
                          rows: 3,
                          class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                          placeholder: "Vos impressions sur cette recette..." %>
        </div>

        <div class="flex justify-end">
          <%= f.submit existing_rating ? "Mettre à jour" : "Noter",
                        class: "px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors" %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-6 text-gray-500">
      <i class="fas fa-lock text-2xl mb-2"></i>
      <p class="text-sm">Seul le créateur de la recette peut la noter</p>
    </div>
  <% end %>
</div>
